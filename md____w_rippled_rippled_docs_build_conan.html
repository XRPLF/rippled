<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rippled: A crash course in CMake and Conan</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">rippled
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">A crash course in CMake and Conan </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >To better understand how to use Conan, we should first understand <em>why</em> we use Conan, and to understand that, we need to understand how we use CMake.</p>
<h2><a class="anchor" id="autotoc_md96"></a>
CMake</h2>
<p >Technically, you don't need CMake to build this project. You could manually compile every translation unit into an object file, using the right compiler options, and then manually link all those objects together, using the right linker options. However, that is very tedious and error-prone, which is why we lean on tools like CMake.</p>
<p >We have written CMake configuration files (<a href="./CMakeLists.txt"><code>CMakeLists.txt</code></a> and friends) for this project so that CMake can be used to correctly compile and link all of the translation units in it. Or rather, CMake will generate files for a separate build system (e.g. Make, Ninja, Visual Studio, Xcode, etc.) that compile and link all of the translation units. Even then, CMake has parameters, some of which are platform-specific. In CMake's parlance, parameters are specially-named <b>variables</b> like <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html"><code>CMAKE_BUILD_TYPE</code></a> or <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_MSVC_RUNTIME_LIBRARY.html"><code>CMAKE_MSVC_RUNTIME_LIBRARY</code></a>. Parameters include:</p>
<ul>
<li>what build system to generate files for</li>
<li>where to find the compiler and linker</li>
<li>where to find dependencies, e.g. libraries and headers</li>
<li>how to link dependencies, e.g. any special compiler or linker flags that need to be used with them, including preprocessor definitions</li>
<li>how to compile translation units, e.g. with optimizations, debug symbols, position-independent code, etc.</li>
<li>on Windows, which runtime library to link with</li>
</ul>
<p >For some of these parameters, like the build system and compiler, CMake goes through a complicated search process to choose default values. For others, like the dependencies, <em>we</em> had written in the CMake configuration files of this project our own complicated process to choose defaults. For most developers, things "just worked"... until they didn't, and then you were left trying to debug one of these complicated processes, instead of choosing and manually passing the parameter values yourself.</p>
<p >You can pass every parameter to CMake on the command line, but writing out these parameters every time we want to configure CMake is a pain. Most humans prefer to put them into a configuration file, once, that CMake can read every time it is configured. For CMake, that file is a <a href="https://cmake.org/cmake/help/latest/manual/cmake-toolchains.7.html">toolchain file</a>.</p>
<h2><a class="anchor" id="autotoc_md97"></a>
Conan</h2>
<p >These next few paragraphs on Conan are going to read much like the ones above for CMake.</p>
<p >Technically, you don't need Conan to build this project. You could manually download, configure, build, and install all of the dependencies yourself, and then pass all of the parameters necessary for CMake to link to those dependencies. To guarantee ABI compatibility, you must be sure to use the same set of compiler and linker options for all dependencies <em>and</em> this project. However, that is very tedious and error-prone, which is why we lean on tools like Conan.</p>
<p >We have written a Conan configuration file (<a href="../../conanfile.py"><code>conanfile.py</code></a>) so that Conan can be used to correctly download, configure, build, and install all of the dependencies for this project, using a single set of compiler and linker options for all of them. It generates files that contain almost all of the parameters that CMake expects. Those files include:</p>
<ul>
<li>A single toolchain file.</li>
<li>For every dependency, a CMake <a href="https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html#package-configuration-file">package configuration file</a>, <a href="https://cmake.org/cmake/help/latest/manual/cmake-packages.7.html#package-version-file">package version file</a>, and for every build type, a package targets file. Together, these files implement version checking and define <code>IMPORTED</code> targets for the dependencies.</li>
</ul>
<p >The toolchain file itself amends the search path (<a href="https://cmake.org/cmake/help/latest/variable/CMAKE_PREFIX_PATH.html"><code>CMAKE_PREFIX_PATH</code></a>) so that <a href="https://cmake.org/cmake/help/latest/command/find_package.html"><code>find_package()</code></a> will <a href="https://cmake.org/cmake/help/latest/command/find_package.html#search-procedure">discover</a> the generated package configuration files.</p>
<p ><b>Nearly all we must do to properly configure CMake is pass the toolchain file.</b> What CMake parameters are left out? You'll still need to pick a build system generator, and if you choose a single-configuration generator, you'll need to pass the <code>CMAKE_BUILD_TYPE</code>, which should match the <code>build_type</code> setting you gave to Conan.</p>
<p >Even then, Conan has parameters, some of which are platform-specific. In Conan's parlance, parameters are either settings or options. <b>Settings</b> are shared by all packages, e.g. the build type. <b>Options</b> are specific to a given package, e.g. whether to build and link OpenSSL as a shared library.</p>
<p >For settings, Conan goes through a complicated search process to choose defaults. For options, each package recipe defines its own defaults.</p>
<p >You can pass every parameter to Conan on the command line, but it is more convenient to put them in a configuration file, once, that Conan can read every time it is configured. For Conan, that file is a <a href="https://docs.conan.io/en/latest/reference/profiles.html">profile</a>. <b>All we must do to properly configure Conan is edit and pass the profile.</b> By default, Conan will use the profile named "default". </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
