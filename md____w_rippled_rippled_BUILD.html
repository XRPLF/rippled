<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>rippled: BUILD</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">rippled
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">BUILD </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >| :warning: <b>WARNING</b> :warning: |&mdash;| | These instructions assume you have a C++ development environment ready with Git, Python, Conan, CMake, and a C++ compiler. For help setting one up on Linux, macOS, or Windows, <a class="el" href="md____w_rippled_rippled_docs_build_environment.html">see this guide</a>. |</p>
<blockquote class="doxtable">
<p >&zwj;These instructions also assume a basic familiarity with Conan and CMake. If you are unfamiliar with Conan, you can read our <a class="el" href="md____w_rippled_rippled_docs_build_conan.html">crash course</a> or the official <a href="https://docs.conan.io/en/latest/getting_started.html">Getting Started</a> walkthrough. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md27"></a>
Branches</h2>
<p >For a stable release, choose the <code>master</code> branch or one of the <a href="https://github.com/ripple/rippled/releases">tagged releases</a>.</p>
<div class="fragment"><div class="line">git checkout master</div>
</div><!-- fragment --><p >For the latest release candidate, choose the <code>release</code> branch.</p>
<div class="fragment"><div class="line">git checkout release</div>
</div><!-- fragment --><p >For the latest set of untested features, or to contribute, choose the <code>develop</code> branch.</p>
<div class="fragment"><div class="line">git checkout develop</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md28"></a>
Minimum Requirements</h2>
<p >See <a href="https://xrpl.org/system-requirements.html">System Requirements</a>.</p>
<p >Building rippled generally requires git, Python, Conan, CMake, and a C++ compiler. Some guidance on setting up such a <a class="el" href="md____w_rippled_rippled_docs_build_environment.html">C++ development environment can be</a>found here".

- &lt;a href="<a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a>" &gt;Python 3.11&lt;/a&gt;, or higher
- &lt;a href="<a href="https://conan.io/downloads.html">https://conan.io/downloads.html</a>" &gt;Conan 2.17&lt;/a&gt;[^1], or higher
- &lt;a href="<a href="https://cmake.org/download/">https://cmake.org/download/</a>" &gt;CMake 3.22&lt;/a&gt;[^2], or higher

[^1]:
    It is possible to build with Conan 1.60+, but the instructions are
    significantly different, which is why we are not recommending it.

[^2]:
    CMake 4 is not yet supported by all dependencies required by this project.
    If you are affected by this issue, follow @ref workaround-for-cmake-4 "conan workaround for cmake 4"

&lt;tt&gt;rippled&lt;/tt&gt; is written in the C++20 dialect and includes the &lt;tt&gt;\&lt;concepts\&gt;&lt;/tt&gt; header.
The &lt;a href="<a href="https://en.cppreference.com/w/cpp/compiler_support/20">https://en.cppreference.com/w/cpp/compiler_support/20</a>" &gt;minimum compiler versions&lt;/a&gt; required are:

&lt;table class="markdownTable"&gt;
  &lt;tr class="markdownTableHead"&gt;    &lt;th class="markdownTableHeadNone"&gt; Compiler   </p>
<p >Version    </p>
<p >GCC   </p>
<p >12    </p>
<p >Clang   </p>
<p >16    </p>
<p >Apple Clang   </p>
<p >16    </p>
<p >MSVC   </p>
<p >19.44[^3]   </p>
<h3><a class="anchor" id="autotoc_md29"></a>
Linux</h3>
<p >The Ubuntu Linux distribution has received the highest level of quality assurance, testing, and support. We also support Red Hat and use Debian internally.</p>
<p >Here are <a href="./docs/build/environment.md#linux">sample instructions for setting up a C++ development environment on Linux</a>.</p>
<h3><a class="anchor" id="autotoc_md30"></a>
Mac</h3>
<p >Many rippled engineers use macOS for development.</p>
<p >Here are <a href="./docs/build/environment.md#macos">sample instructions for setting up a C++ development environment on macOS</a>.</p>
<h3><a class="anchor" id="autotoc_md31"></a>
Windows</h3>
<p >Windows is used by some engineers for development only.</p>
<p >[^3]: Windows is not recommended for production use.</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Steps</h2>
<h3><a class="anchor" id="autotoc_md33"></a>
Set Up Conan</h3>
<p >After you have a <a class="el" href="md____w_rippled_rippled_docs_build_environment.html">C++ development environment</a> ready with Git, Python, Conan, CMake, and a C++ compiler, you may need to set up your Conan profile.</p>
<p >These instructions assume a basic familiarity with Conan and CMake. If you are unfamiliar with Conan, then please read <a class="el" href="md____w_rippled_rippled_docs_build_conan.html">this crash course</a> or the official <a href="https://docs.conan.io/en/latest/getting_started.html">Getting Started</a> walkthrough.</p>
<h4><a class="anchor" id="autotoc_md34"></a>
Default profile</h4>
<p >We recommend that you import the provided <code>conan/profiles/default</code> profile:</p>
<div class="fragment"><div class="line">conan config install conan/profiles/ -tf $(conan config home)/profiles/</div>
</div><!-- fragment --><p >You can check your Conan profile by running:</p>
<div class="fragment"><div class="line">conan profile show</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md35"></a>
Custom profile</h4>
<p >If the default profile does not work for you and you do not yet have a Conan profile, you can create one by running:</p>
<div class="fragment"><div class="line">conan profile detect</div>
</div><!-- fragment --><p >You may need to make changes to the profile to suit your environment. You can refer to the provided <code>conan/profiles/default</code> profile for inspiration, and you may also need to apply the required tweaks to this default profile.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
Patched recipes</h3>
<p >The recipes in Conan Center occasionally need to be patched for compatibility with the latest version of <code>rippled</code>. We maintain a fork of the Conan Center <a href="https://github.com/XRPLF/conan-center-index/">here</a> containing the patches.</p>
<p >To ensure our patched recipes are used, you must add our Conan remote at a higher index than the default Conan Center remote, so it is consulted first. You can do this by running:</p>
<div class="fragment"><div class="line">conan remote add --index 0 xrplf &quot;https://conan.ripplex.io&quot;</div>
</div><!-- fragment --><p >Alternatively, you can pull the patched recipes into the repository and use them locally:</p>
<div class="fragment"><div class="line">cd external</div>
<div class="line">git init</div>
<div class="line">git remote add origin git@github.com:XRPLF/conan-center-index.git</div>
<div class="line">git sparse-checkout init</div>
<div class="line">git sparse-checkout set recipes/snappy</div>
<div class="line">git sparse-checkout add recipes/soci</div>
<div class="line">git fetch origin master</div>
<div class="line">git checkout master</div>
<div class="line">conan export --version 1.1.10 recipes/snappy/all</div>
<div class="line">conan export --version 4.0.3 recipes/soci/all</div>
<div class="line">rm -rf .git</div>
</div><!-- fragment --><p >In the case we switch to a newer version of a dependency that still requires a patch, it will be necessary for you to pull in the changes and re-export the updated dependencies with the newer version. However, if we switch to a newer version that no longer requires a patch, no action is required on your part, as the new recipe will be automatically pulled from the official Conan Center.</p>
<h3><a class="anchor" id="autotoc_md37"></a>
Conan profile tweaks</h3>
<h4><a class="anchor" id="autotoc_md38"></a>
Missing compiler version</h4>
<p >If you see an error similar to the following after running <code>conan profile show</code>:</p>
<div class="fragment"><div class="line">ERROR: Invalid setting &#39;17&#39; is not a valid &#39;settings.compiler.version&#39; value.</div>
<div class="line">Possible values are [&#39;5.0&#39;, &#39;5.1&#39;, &#39;6.0&#39;, &#39;6.1&#39;, &#39;7.0&#39;, &#39;7.3&#39;, &#39;8.0&#39;, &#39;8.1&#39;,</div>
<div class="line">&#39;9.0&#39;, &#39;9.1&#39;, &#39;10.0&#39;, &#39;11.0&#39;, &#39;12.0&#39;, &#39;13&#39;, &#39;13.0&#39;, &#39;13.1&#39;, &#39;14&#39;, &#39;14.0&#39;, &#39;15&#39;,</div>
<div class="line">&#39;15.0&#39;, &#39;16&#39;, &#39;16.0&#39;]</div>
<div class="line">Read &quot;http://docs.conan.io/2/knowledge/faq.html#error-invalid-setting&quot;</div>
</div><!-- fragment --><p >you need to amend the list of compiler versions in <code>$(conan config home)/settings.yml</code>, by appending the required version number(s) to the <code>version</code> array specific for your compiler. For example:</p>
<div class="fragment"><div class="line">apple-clang:</div>
<div class="line">  version:</div>
<div class="line">    [</div>
<div class="line">      &quot;5.0&quot;,</div>
<div class="line">      &quot;5.1&quot;,</div>
<div class="line">      &quot;6.0&quot;,</div>
<div class="line">      &quot;6.1&quot;,</div>
<div class="line">      &quot;7.0&quot;,</div>
<div class="line">      &quot;7.3&quot;,</div>
<div class="line">      &quot;8.0&quot;,</div>
<div class="line">      &quot;8.1&quot;,</div>
<div class="line">      &quot;9.0&quot;,</div>
<div class="line">      &quot;9.1&quot;,</div>
<div class="line">      &quot;10.0&quot;,</div>
<div class="line">      &quot;11.0&quot;,</div>
<div class="line">      &quot;12.0&quot;,</div>
<div class="line">      &quot;13&quot;,</div>
<div class="line">      &quot;13.0&quot;,</div>
<div class="line">      &quot;13.1&quot;,</div>
<div class="line">      &quot;14&quot;,</div>
<div class="line">      &quot;14.0&quot;,</div>
<div class="line">      &quot;15&quot;,</div>
<div class="line">      &quot;15.0&quot;,</div>
<div class="line">      &quot;16&quot;,</div>
<div class="line">      &quot;16.0&quot;,</div>
<div class="line">      &quot;17&quot;,</div>
<div class="line">      &quot;17.0&quot;,</div>
<div class="line">    ]</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md39"></a>
Multiple compilers</h4>
<p >If you have multiple compilers installed, make sure to select the one to use in your default Conan configuration <b>before</b> running <code>conan profile detect</code>, by setting the <code>CC</code> and <code>CXX</code> environment variables.</p>
<p >For example, if you are running MacOS and have <a href="https://formulae.brew.sh/formula/llvm@18">homebrew LLVM@18</a>, and want to use it as a compiler in the new Conan profile:</p>
<div class="fragment"><div class="line">export CC=$(brew --prefix llvm@18)/bin/clang</div>
<div class="line">export CXX=$(brew --prefix llvm@18)/bin/clang++</div>
<div class="line">conan profile detect</div>
</div><!-- fragment --><p >You should also explicitly set the path to the compiler in the profile file, which helps to avoid errors when <code>CC</code> and/or <code>CXX</code> are set and disagree with the selected Conan profile. For example:</p>
<div class="fragment"><div class="line">[conf]</div>
<div class="line">tools.build:compiler_executables={&#39;c&#39;:&#39;/usr/bin/gcc&#39;,&#39;cpp&#39;:&#39;/usr/bin/g++&#39;}</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md40"></a>
Multiple profiles</h4>
<p >You can manage multiple Conan profiles in the directory <code>$(conan config home)/profiles</code>, for example renaming <code>default</code> to a different name and then creating a new <code>default</code> profile for a different compiler.</p>
<h4><a class="anchor" id="autotoc_md41"></a>
Select language</h4>
<p >The default profile created by Conan will typically select different C++ dialect than C++20 used by this project. You should set <code>20</code> in the profile line starting with <code>compiler.cppstd=</code>. For example:</p>
<div class="fragment"><div class="line">sed -i.bak -e &#39;s|^compiler\.cppstd=.*$|compiler.cppstd=20|&#39; $(conan config home)/profiles/default</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md42"></a>
Select standard library in Linux</h4>
<p ><b>Linux</b> developers will commonly have a default Conan <a href="https://docs.conan.io/en/latest/reference/profiles.html">profile</a> that compiles with GCC and links with libstdc++. If you are linking with libstdc++ (see profile setting <code>compiler.libcxx</code>), then you will need to choose the <code>libstdc++11</code> ABI:</p>
<div class="fragment"><div class="line">sed -i.bak -e &#39;s|^compiler\.libcxx=.*$|compiler.libcxx=libstdc++11|&#39; $(conan config home)/profiles/default</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md43"></a>
Select architecture and runtime in Windows</h4>
<p ><b>Windows</b> developers may need to use the x64 native build tools. An easy way to do that is to run the shortcut "x64 Native Tools Command Prompt" for the version of Visual Studio that you have installed.</p>
<p >Windows developers must also build <code>rippled</code> and its dependencies for the x64 architecture:</p>
<div class="fragment"><div class="line">sed -i.bak -e &#39;s|^arch=.*$|arch=x86_64|&#39; $(conan config home)/profiles/default</div>
</div><!-- fragment --><p ><b>Windows</b> developers also must select static runtime:</p>
<div class="fragment"><div class="line">sed -i.bak -e &#39;s|^compiler\.runtime=.*$|compiler.runtime=static|&#39; $(conan config home)/profiles/default</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md44"></a>
Workaround for CMake 4</h4>
<p >If your system CMake is version 4 rather than 3, you may have to configure Conan profile to use CMake version 3 for dependencies, by adding the following two lines to your profile:</p>
<div class="fragment"><div class="line">[tool_requires]</div>
<div class="line">!cmake/*: cmake/[&gt;=3 &lt;4]</div>
</div><!-- fragment --><p >This will force Conan to download and use a locally cached CMake 3 version, and is needed because some of the dependencies used by this project do not support CMake 4.</p>
<h4><a class="anchor" id="autotoc_md45"></a>
Clang workaround for grpc</h4>
<p >If your compiler is clang, version 19 or later, or apple-clang, version 17 or later, you may encounter a compilation error while building the <code>grpc</code> dependency:</p>
<div class="fragment"><div class="line">In file included from .../lib/promise/try_seq.h:26:</div>
<div class="line">.../lib/promise/detail/basic_seq.h:499:38: error: a template argument list is expected after a name prefixed by the template keyword [-Wmissing-template-arg-list-after-template-kw]</div>
<div class="line">  499 |                     Traits::template CallSeqFactory(f_, *cur_, std::move(arg)));</div>
<div class="line">      |                                      ^</div>
</div><!-- fragment --><p >The workaround for this error is to add two lines to profile:</p>
<div class="fragment"><div class="line">[conf]</div>
<div class="line">tools.build:cxxflags=[&#39;-Wno-missing-template-arg-list-after-template-kw&#39;]</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md46"></a>
Workaround for gcc 12</h4>
<p >If your compiler is gcc, version 12, and you have enabled <code>werr</code> option, you may encounter a compilation error such as:</p>
<div class="fragment"><div class="line">/usr/include/c++/12/bits/char_traits.h:435:56: error: &#39;void* __builtin_memcpy(void*, const void*, long unsigned int)&#39; accessing 9223372036854775810 or more bytes at offsets [2, 9223372036854775807] and 1 may overlap up to 9223372036854775813 bytes at offset -3 [-Werror=restrict]</div>
<div class="line">  435 |         return static_cast&lt;char_type*&gt;(__builtin_memcpy(__s1, __s2, __n));</div>
<div class="line">      |                                        ~~~~~~~~~~~~~~~~^~~~~~~~~~~~~~~~~</div>
<div class="line">cc1plus: all warnings being treated as errors</div>
</div><!-- fragment --><p >The workaround for this error is to add two lines to your profile:</p>
<div class="fragment"><div class="line">[conf]</div>
<div class="line">tools.build:cxxflags=[&#39;-Wno-restrict&#39;]</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md47"></a>
Workaround for clang 16</h4>
<p >If your compiler is clang, version 16, you may encounter compilation error such as:</p>
<div class="fragment"><div class="line">In file included from .../boost/beast/websocket/stream.hpp:2857:</div>
<div class="line">.../boost/beast/websocket/impl/read.hpp:695:17: error: call to &#39;async_teardown&#39; is ambiguous</div>
<div class="line">                async_teardown(impl.role, impl.stream(),</div>
<div class="line">                ^~~~~~~~~~~~~~</div>
</div><!-- fragment --><p >The workaround for this error is to add two lines to your profile:</p>
<div class="fragment"><div class="line">[conf]</div>
<div class="line">tools.build:cxxflags=[&#39;-DBOOST_ASIO_DISABLE_CONCEPTS&#39;]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md48"></a>
Build and Test</h3>
<ol type="1">
<li><p class="startli">Create a build directory and move into it.</p>
<div class="fragment"><div class="line">mkdir .build</div>
<div class="line">cd .build</div>
</div><!-- fragment --><p class="startli">You can use any directory name. Conan treats your working directory as an install folder and generates files with implementation details. You don't need to worry about these files, but make sure to change your working directory to your build directory before calling Conan.</p>
<p class="startli"><b>Note:</b> You can specify a directory for the installation files by adding the <code>install-folder</code> or <code>-if</code> option to every <code>conan install</code> command in the next step.</p>
</li>
<li><p class="startli">Use conan to generate CMake files for every configuration you want to build:</p>
<div class="fragment"><div class="line">conan install .. --output-folder . --build missing --settings build_type=Release</div>
<div class="line">conan install .. --output-folder . --build missing --settings build_type=Debug</div>
</div><!-- fragment --><p class="startli">To build Debug, in the next step, be sure to set <code>-DCMAKE_BUILD_TYPE=Debug</code></p>
<p class="startli">For a single-configuration generator, e.g. <code>Unix Makefiles</code> or <code>Ninja</code>, you only need to run this command once. For a multi-configuration generator, e.g. <code>Visual Studio</code>, you may want to run it more than once.</p>
<p class="startli">Each of these commands should also have a different <code>build_type</code> setting. A second command with the same <code>build_type</code> setting will overwrite the files generated by the first. You can pass the build type on the command line with <code>--settings build_type=$BUILD_TYPE</code> or in the profile itself, under the section <code>[settings]</code> with the key <code>build_type</code>.</p>
<p class="startli">If you are using a Microsoft Visual C++ compiler, then you will need to ensure consistency between the <code>build_type</code> setting and the <code>compiler.runtime</code> setting.</p>
<p class="startli">When <code>build_type</code> is <code>Release</code>, <code>compiler.runtime</code> should be <code>MT</code>.</p>
<p class="startli">When <code>build_type</code> is <code>Debug</code>, <code>compiler.runtime</code> should be <code>MTd</code>.</p>
<div class="fragment"><div class="line">conan install .. --output-folder . --build missing --settings build_type=Release --settings compiler.runtime=MT</div>
<div class="line">conan install .. --output-folder . --build missing --settings build_type=Debug --settings compiler.runtime=MTd</div>
</div><!-- fragment --></li>
<li><p class="startli">Configure CMake and pass the toolchain file generated by Conan, located at <code>$OUTPUT_FOLDER/build/generators/conan_toolchain.cmake</code>.</p>
<p class="startli">Single-config generators:</p>
<p class="startli">Pass the CMake variable <a href="https://cmake.org/cmake/help/latest/variable/CMAKE_BUILD_TYPE.html"><code>CMAKE_BUILD_TYPE</code></a> and make sure it matches the one of the <code>build_type</code> settings you chose in the previous step.</p>
<p class="startli">For example, to build Debug, in the next command, replace "Release" with "Debug"</p>
<div class="fragment"><div class="line">cmake -DCMAKE_TOOLCHAIN_FILE:FILEPATH=build/generators/conan_toolchain.cmake -DCMAKE_BUILD_TYPE=Release -Dxrpld=ON -Dtests=ON ..</div>
</div><!-- fragment --><p class="startli">Multi-config generators:</p>
<div class="fragment"><div class="line">cmake -DCMAKE_TOOLCHAIN_FILE:FILEPATH=build/generators/conan_toolchain.cmake -Dxrpld=ON -Dtests=ON  ..</div>
</div><!-- fragment --><p class="startli"><b>Note:</b> You can pass build options for <code>rippled</code> in this step.</p>
</li>
<li><p class="startli">Build <code>rippled</code>.</p>
<p class="startli">For a single-configuration generator, it will build whatever configuration you passed for <code>CMAKE_BUILD_TYPE</code>. For a multi-configuration generator, you must pass the option <code>--config</code> to select the build configuration.</p>
<p class="startli">Single-config generators:</p>
<div class="fragment"><div class="line">cmake --build .</div>
</div><!-- fragment --><p class="startli">Multi-config generators:</p>
<div class="fragment"><div class="line">cmake --build . --config Release</div>
<div class="line">cmake --build . --config Debug</div>
</div><!-- fragment --></li>
<li><p class="startli">Test rippled.</p>
<p class="startli">Single-config generators:</p>
<div class="fragment"><div class="line">./rippled --unittest --unittest-jobs N</div>
</div><!-- fragment --><p class="startli">Multi-config generators:</p>
<div class="fragment"><div class="line">./Release/rippled --unittest --unittest-jobs N</div>
<div class="line">./Debug/rippled --unittest --unittest-jobs N</div>
</div><!-- fragment --><p class="startli">Replace the <code>--unittest-jobs</code> parameter N with the desired unit tests concurrency. Recommended setting is half of the number of available CPU cores.</p>
<p class="startli">The location of <code>rippled</code> binary in your build directory depends on your CMake generator. Pass <code>--help</code> to see the rest of the command line options.</p>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md49"></a>
Coverage report</h2>
<p >The coverage report is intended for developers using compilers GCC or Clang (including Apple Clang). It is generated by the build target <code>coverage</code>, which is only enabled when the <code>coverage</code> option is set, e.g. with <code>--options coverage=True</code> in <code>conan</code> or <code>-Dcoverage=ON</code> variable in <code>cmake</code></p>
<p >Prerequisites for the coverage report:</p>
<ul>
<li><a href="https://gcovr.com/en/stable/getting-started.html">gcovr tool</a> (can be installed e.g. with <a href="https://packaging.python.org/en/latest/guides/installing-using-pip-and-virtual-environments/">pip</a>)</li>
<li><code>gcov</code> for GCC (installed with the compiler by default) or</li>
<li><code>llvm-cov</code> for Clang (installed with the compiler by default)</li>
<li><code>Debug</code> build type</li>
</ul>
<p >A coverage report is created when the following steps are completed, in order:</p>
<ol type="1">
<li><code>rippled</code> binary built with instrumentation data, enabled by the <code>coverage</code> option mentioned above</li>
<li>completed run of unit tests, which populates coverage capture data</li>
<li>completed run of the <code>gcovr</code> tool (which internally invokes either <code>gcov</code> or <code>llvm-cov</code>) to assemble both instrumentation data and the coverage capture data into a coverage report</li>
</ol>
<p >The above steps are automated into a single target <code>coverage</code>. The instrumented <code>rippled</code> binary can also be used for regular development or testing work, at the cost of extra disk space utilization and a small performance hit (to store coverage capture). In case of a spurious failure of unit tests, it is possible to re-run the <code>coverage</code> target without rebuilding the <code>rippled</code> binary (since it is simply a dependency of the coverage report target). It is also possible to select only specific tests for the purpose of the coverage report, by setting the <code>coverage_test</code> variable in <code>cmake</code></p>
<p >The default coverage report format is <code>html-details</code>, but the user can override it to any of the formats listed in <code>Builds/CMake/CodeCoverage.cmake</code> by setting the <code>coverage_format</code> variable in <code>cmake</code>. It is also possible to generate more than one format at a time by setting the <code>coverage_extra_args</code> variable in <code>cmake</code>. The specific command line used to run the <code>gcovr</code> tool will be displayed if the <code>CODE_COVERAGE_VERBOSE</code> variable is set.</p>
<p >By default, the code coverage tool runs parallel unit tests with <code>--unittest-jobs</code> set to the number of available CPU cores. This may cause spurious test errors on Apple. Developers can override the number of unit test jobs with the <code>coverage_test_parallelism</code> variable in <code>cmake</code>.</p>
<p >Example use with some cmake variables set:</p>
<div class="fragment"><div class="line">cd .build</div>
<div class="line">conan install .. --output-folder . --build missing --settings build_type=Debug</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Debug -Dcoverage=ON -Dxrpld=ON -Dtests=ON -Dcoverage_test_parallelism=2 -Dcoverage_format=html-details -Dcoverage_extra_args=&quot;--json coverage.json&quot; -DCMAKE_TOOLCHAIN_FILE:FILEPATH=build/generators/conan_toolchain.cmake ..</div>
<div class="line">cmake --build . --target coverage</div>
</div><!-- fragment --><p >After the <code>coverage</code> target is completed, the generated coverage report will be stored inside the build directory, as either of:</p>
<ul>
<li>file named <code>coverage.</code>_extension_, with a suitable extension for the report format, or</li>
<li>directory named <code>coverage</code>, with the <code>index.html</code> and other files inside, for the <code>html-details</code> or <code>html-nested</code> report formats.</li>
</ul>
<h2><a class="anchor" id="autotoc_md50"></a>
Options</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Default Value   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>assert</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Enable assertions.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>coverage</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Prepare the coverage report.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>san</code>   </td><td class="markdownTableBodyNone">N/A   </td><td class="markdownTableBodyNone">Enable a sanitizer with Clang. Choices are <code>thread</code> and <code>address</code>.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>tests</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Build tests.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>unity</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Configure a unity build.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>xrpld</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Build the xrpld (<code>rippled</code>) application, and not just the libxrpl library.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>werr</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Treat compilation warnings as errors    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>wextra</code>   </td><td class="markdownTableBodyNone">OFF   </td><td class="markdownTableBodyNone">Enable additional compilation warnings   </td></tr>
</table>
<p ><a href="https://en.wikipedia.org/wiki/Unity_build">Unity builds</a> may be faster for the first build (at the cost of much more memory) since they concatenate sources into fewer translation units. Non-unity builds may be faster for incremental builds, and can be helpful for detecting <code>#include</code> omissions.</p>
<h2><a class="anchor" id="autotoc_md51"></a>
Troubleshooting</h2>
<h3><a class="anchor" id="autotoc_md52"></a>
Conan</h3>
<p >After any updates or changes to dependencies, you may need to do the following:</p>
<ol type="1">
<li>Remove your build directory.</li>
<li><p class="startli">Remove individual libraries from the Conan cache, e.g.</p>
<div class="fragment"><div class="line">conan remove &#39;grpc/*&#39;</div>
</div><!-- fragment --><p class="startli"><b>or</b></p>
<p class="startli">Remove all libraries from Conan cache:</p>
<div class="fragment"><div class="line">conan remove &#39;*&#39;</div>
</div><!-- fragment --></li>
<li>Re-run conan export if needed.</li>
<li>Re-run conan install.</li>
</ol>
<h3><a class="anchor" id="autotoc_md53"></a>
&lt;tt&gt;protobuf/port_def.inc&lt;/tt&gt; file not found</h3>
<p >If <code>cmake --build .</code> results in an error due to a missing a protobuf file, then you might have generated CMake files for a different <code>build_type</code> than the <code>CMAKE_BUILD_TYPE</code> you passed to Conan.</p>
<div class="fragment"><div class="line">/rippled/.build/pb-xrpl.libpb/xrpl/proto/ripple.pb.h:10:10: fatal error: &#39;google/protobuf/port_def.inc&#39; file not found</div>
<div class="line">   10 | #include &lt;google/protobuf/port_def.inc&gt;</div>
<div class="line">      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</div>
<div class="line">1 error generated.</div>
</div><!-- fragment --><p >For example, if you want to build Debug:</p>
<ol type="1">
<li>For conan install, pass <code>--settings build_type=Debug</code></li>
<li>For cmake, pass <code>-DCMAKE_BUILD_TYPE=Debug</code></li>
</ol>
<h2><a class="anchor" id="autotoc_md54"></a>
Add a Dependency</h2>
<p >If you want to experiment with a new package, follow these steps:</p>
<ol type="1">
<li>Search for the package on <a href="https://conan.io/center/">Conan Center</a>.</li>
<li>Modify <a href="./conanfile.py"><code>conanfile.py</code></a>:<ul>
<li>Add a version of the package to the <code>requires</code> property.</li>
<li>Change any default options for the package by adding them to the <code>default_options</code> property (with syntax &lsquo;&rsquo;$package:$option': $value<code>).</code></li>
</ul>
</li>
<li><code>Modify [</code>CMakeLists.txt<code>](./CMakeLists.txt):<ul>
<li>Add a call tofind_package($package REQUIRED)<code>.</code></li>
<li><code>Link a library from the package to the target</code>ripple_libs<code> (search for the existing call to</code>target_link_libraries(ripple_libs INTERFACE ...)`).</li>
</ul>
</code></li>
<li><code>Start coding! Don't forget to include whatever headers you need from the package. </code></li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
