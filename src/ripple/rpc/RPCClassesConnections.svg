<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="809px" preserveAspectRatio="none" style="width:2144px;height:809px;" version="1.1" viewBox="0 0 2144 809" width="2144px" zoomAndPan="magnify"><defs><filter height="300%" id="f16tdukpljcqty" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--class io_list--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="86.4141" id="io_list" style="stroke: #A80036; stroke-width: 1.5;" width="378" x="1374" y="160.5"/><ellipse cx="1541.25" cy="176.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1544.2188,182.1406 Q1543.6406,182.4375 1543,182.5781 Q1542.3594,182.7344 1541.6563,182.7344 Q1539.1563,182.7344 1537.8281,181.0938 Q1536.5156,179.4375 1536.5156,176.3125 Q1536.5156,173.1875 1537.8281,171.5313 Q1539.1563,169.875 1541.6563,169.875 Q1542.3594,169.875 1543,170.0313 Q1543.6563,170.1875 1544.2188,170.4844 L1544.2188,173.2031 Q1543.5938,172.625 1543,172.3594 Q1542.4063,172.0781 1541.7813,172.0781 Q1540.4375,172.0781 1539.75,173.1563 Q1539.0625,174.2188 1539.0625,176.3125 Q1539.0625,178.4063 1539.75,179.4844 Q1540.4375,180.5469 1541.7813,180.5469 Q1542.4063,180.5469 1543,180.2813 Q1543.5938,180 1544.2188,179.4219 L1544.2188,182.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="35" x="1561.75" y="180.6543">io_list</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1375" x2="1751" y1="192.5" y2="192.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="366" x="1380" y="206.7104">boost::container::flat_map&lt;work*, std::weak_ptr&lt;work&gt;&gt; map_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1375" x2="1751" y1="213.3047" y2="213.3047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="1380" y="227.5151">emplace()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="38" x="1380" y="240.3198">close()</text><!--class io_list::work--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="86.4141" id="io_list::work" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="1200" y="8"/><ellipse cx="1215" cy="24" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1217.9688,29.6406 Q1217.3906,29.9375 1216.75,30.0781 Q1216.1094,30.2344 1215.4063,30.2344 Q1212.9063,30.2344 1211.5781,28.5938 Q1210.2656,26.9375 1210.2656,23.8125 Q1210.2656,20.6875 1211.5781,19.0313 Q1212.9063,17.375 1215.4063,17.375 Q1216.1094,17.375 1216.75,17.5313 Q1217.4063,17.6875 1217.9688,17.9844 L1217.9688,20.7031 Q1217.3438,20.125 1216.75,19.8594 Q1216.1563,19.5781 1215.5313,19.5781 Q1214.1875,19.5781 1213.5,20.6563 Q1212.8125,21.7188 1212.8125,23.8125 Q1212.8125,25.9063 1213.5,26.9844 Q1214.1875,28.0469 1215.5313,28.0469 Q1216.1563,28.0469 1216.75,27.7813 Q1217.3438,27.5 1217.9688,26.9219 L1217.9688,29.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="72" x="1229" y="28.1543">io_list::work</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1201" x2="1303" y1="40" y2="40"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="1206" y="54.2104">io_list* ios_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1201" x2="1303" y1="60.8047" y2="60.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="1206" y="75.0151">io_list&amp; ios()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="89" x="1206" y="87.8198">void close() = 0</text><polygon fill="#FBFB77" filter="url(#f16tdukpljcqty)" points="616,772,616,797.1328,958,797.1328,958,782,948,772,616,772" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="948" x2="948" y1="772" y2="782"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="958" x2="948" y1="782" y2="782"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="622" y="789.0669">Handler template parameter is ServerHandlerImpl</text><!--class BaseHTTPPeer<Handler,Impl>--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="150.4375" id="BaseHTTPPeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="307" x="314.5" y="345"/><ellipse cx="369.25" cy="361" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M372.2188,366.6406 Q371.6406,366.9375 371,367.0781 Q370.3594,367.2344 369.6563,367.2344 Q367.1563,367.2344 365.8281,365.5938 Q364.5156,363.9375 364.5156,360.8125 Q364.5156,357.6875 365.8281,356.0313 Q367.1563,354.375 369.6563,354.375 Q370.3594,354.375 371,354.5313 Q371.6563,354.6875 372.2188,354.9844 L372.2188,357.7031 Q371.5938,357.125 371,356.8594 Q370.4063,356.5781 369.7813,356.5781 Q368.4375,356.5781 367.75,357.6563 Q367.0625,358.7188 367.0625,360.8125 Q367.0625,362.9063 367.75,363.9844 Q368.4375,365.0469 369.7813,365.0469 Q370.4063,365.0469 371,364.7813 Q371.5938,364.5 372.2188,363.9219 L372.2188,366.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="189" x="389.75" y="365.1543">BaseHTTPPeer&lt;Handler,Impl&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="315.5" x2="620.5" y1="377" y2="377"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="107" x="320.5" y="391.2104">Handler&amp; handler_</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="295" x="320.5" y="404.0151">boost::asio::strand&lt;boost::asio::executor&gt; strand_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="315.5" x2="620.5" y1="410.6094" y2="410.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="320.5" y="424.8198">write()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="54" x="320.5" y="437.6245">do_read()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="320.5" y="450.4292">complete()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="38" x="320.5" y="463.2339">close()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="96" x="320.5" y="476.0386">do_request() = 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="82" x="320.5" y="488.8433">do_close() = 0</text><!--class PlainHTTPPeer<Handler>--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="112.0234" id="PlainHTTPPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="301" x="432.5" y="593.5"/><ellipse cx="499.25" cy="609.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M502.2188,615.1406 Q501.6406,615.4375 501,615.5781 Q500.3594,615.7344 499.6563,615.7344 Q497.1563,615.7344 495.8281,614.0938 Q494.5156,612.4375 494.5156,609.3125 Q494.5156,606.1875 495.8281,604.5313 Q497.1563,602.875 499.6563,602.875 Q500.3594,602.875 501,603.0313 Q501.6563,603.1875 502.2188,603.4844 L502.2188,606.2031 Q501.5938,605.625 501,605.3594 Q500.4063,605.0781 499.7813,605.0781 Q498.4375,605.0781 497.75,606.1563 Q497.0625,607.2188 497.0625,609.3125 Q497.0625,611.4063 497.75,612.4844 Q498.4375,613.5469 499.7813,613.5469 Q500.4063,613.5469 501,613.2813 Q501.5938,613 502.2188,612.4219 L502.2188,615.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="159" x="519.75" y="613.6543">PlainHTTPPeer&lt;Handler&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="433.5" x2="732.5" y1="625.5" y2="625.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="203" x="438.5" y="639.7104">boost::asio::ip::tcp::socket stream_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="433.5" x2="732.5" y1="646.3047" y2="646.3047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="27" x="438.5" y="660.5151">run()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="289" x="438.5" y="673.3198">std::shared_ptr&lt;WSSession&gt; websocketUpgrade()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="438.5" y="686.1245">do_request()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="438.5" y="698.9292">do_close()</text><!--class SSLHTTPPeer<Handler>--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="124.8281" id="SSLHTTPPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="320" x="6" y="587"/><ellipse cx="86.25" cy="603" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M89.2188,608.6406 Q88.6406,608.9375 88,609.0781 Q87.3594,609.2344 86.6563,609.2344 Q84.1563,609.2344 82.8281,607.5938 Q81.5156,605.9375 81.5156,602.8125 Q81.5156,599.6875 82.8281,598.0313 Q84.1563,596.375 86.6563,596.375 Q87.3594,596.375 88,596.5313 Q88.6563,596.6875 89.2188,596.9844 L89.2188,599.7031 Q88.5938,599.125 88,598.8594 Q87.4063,598.5781 86.7813,598.5781 Q85.4375,598.5781 84.75,599.6563 Q84.0625,600.7188 84.0625,602.8125 Q84.0625,604.9063 84.75,605.9844 Q85.4375,607.0469 86.7813,607.0469 Q87.4063,607.0469 88,606.7813 Q88.5938,606.5 89.2188,605.9219 L89.2188,608.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="151" x="106.75" y="607.1543">SSLHTTPPeer&lt;Handler&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="325" y1="619" y2="619"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="213" x="12" y="633.2104">boost::asio::ip::tcp::socket&amp; stream_</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="308" x="12" y="646.0151">std::unique_ptr&lt;boost::asio::ssl_bundle&gt; ssl_bundle_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="325" y1="652.6094" y2="652.6094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="90" x="12" y="666.8198">do_handshake()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="72" x="12" y="679.6245">do_request()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="12" y="692.4292">do_close()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="83" x="12" y="705.2339">on_shutdown()</text><!--class BasePeer<Handler,Impl>--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="86.4141" id="BasePeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="307" x="787.5" y="160.5"/><ellipse cx="857.75" cy="176.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M860.7188,182.1406 Q860.1406,182.4375 859.5,182.5781 Q858.8594,182.7344 858.1563,182.7344 Q855.6563,182.7344 854.3281,181.0938 Q853.0156,179.4375 853.0156,176.3125 Q853.0156,173.1875 854.3281,171.5313 Q855.6563,169.875 858.1563,169.875 Q858.8594,169.875 859.5,170.0313 Q860.1563,170.1875 860.7188,170.4844 L860.7188,173.2031 Q860.0938,172.625 859.5,172.3594 Q858.9063,172.0781 858.2813,172.0781 Q856.9375,172.0781 856.25,173.1563 Q855.5625,174.2188 855.5625,176.3125 Q855.5625,178.4063 856.25,179.4844 Q856.9375,180.5469 858.2813,180.5469 Q858.9063,180.5469 859.5,180.2813 Q860.0938,180 860.7188,179.4219 L860.7188,182.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="158" x="878.25" y="180.6543">BasePeer&lt;Handler,Impl&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="788.5" x2="1093.5" y1="192.5" y2="192.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="107" x="793.5" y="206.7104">Handler&amp; handler_</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="295" x="793.5" y="219.5151">boost::asio::strand&lt;boost::asio::executor&gt; strand_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="788.5" x2="1093.5" y1="226.1094" y2="226.1094"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="38" x="793.5" y="240.3198">close()</text><!--class BaseWSPeer<Handler,Impl>--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="214.4609" id="BaseWSPeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="245" x="1067.5" y="313"/><ellipse cx="1098.7" cy="329" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1101.6688,334.6406 Q1101.0906,334.9375 1100.45,335.0781 Q1099.8094,335.2344 1099.1063,335.2344 Q1096.6063,335.2344 1095.2781,333.5938 Q1093.9656,331.9375 1093.9656,328.8125 Q1093.9656,325.6875 1095.2781,324.0313 Q1096.6063,322.375 1099.1063,322.375 Q1099.8094,322.375 1100.45,322.5313 Q1101.1063,322.6875 1101.6688,322.9844 L1101.6688,325.7031 Q1101.0438,325.125 1100.45,324.8594 Q1099.8563,324.5781 1099.2313,324.5781 Q1097.8875,324.5781 1097.2,325.6563 Q1096.5125,326.7188 1096.5125,328.8125 Q1096.5125,330.9063 1097.2,331.9844 Q1097.8875,333.0469 1099.2313,333.0469 Q1099.8563,333.0469 1100.45,332.7813 Q1101.0438,332.5 1101.6688,331.9219 L1101.6688,334.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="177" x="1116.3" y="333.1543">BaseWSPeer&lt;Handler,Impl&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1068.5" x2="1311.5" y1="345" y2="345"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="170" x="1073.5" y="359.2104">boost::beast::multi_buffer rb_</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="174" x="1073.5" y="372.0151">boost::beast::multi_buffer wb_</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="233" x="1073.5" y="384.8198">std::list&lt;std::shared_ptr&lt;WSMsg&gt;&gt; wq_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1068.5" x2="1311.5" y1="391.4141" y2="391.4141"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="27" x="1073.5" y="405.6245">run()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="1073.5" y="418.4292">send()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="38" x="1073.5" y="431.2339">close()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="1073.5" y="444.0386">complete()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="112" x="1073.5" y="456.8433">on_ws_handshake()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="1073.5" y="469.6479">do_write()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="54" x="1073.5" y="482.4526">do_read()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="56" x="1073.5" y="495.2573">on_write()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="54" x="1073.5" y="508.062">on_read()</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="1073.5" y="520.8667">on_close()</text><!--class SSLWSPeer<Handler>--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="73.6094" id="SSLWSPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="467" x="1230.5" y="612.5"/><ellipse cx="1390.25" cy="628.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1393.2188,634.1406 Q1392.6406,634.4375 1392,634.5781 Q1391.3594,634.7344 1390.6563,634.7344 Q1388.1563,634.7344 1386.8281,633.0938 Q1385.5156,631.4375 1385.5156,628.3125 Q1385.5156,625.1875 1386.8281,623.5313 Q1388.1563,621.875 1390.6563,621.875 Q1391.3594,621.875 1392,622.0313 Q1392.6563,622.1875 1393.2188,622.4844 L1393.2188,625.2031 Q1392.5938,624.625 1392,624.3594 Q1391.4063,624.0781 1390.7813,624.0781 Q1389.4375,624.0781 1388.75,625.1563 Q1388.0625,626.2188 1388.0625,628.3125 Q1388.0625,630.4063 1388.75,631.4844 Q1389.4375,632.5469 1390.7813,632.5469 Q1391.4063,632.5469 1392,632.2813 Q1392.5938,632 1393.2188,631.4219 L1393.2188,634.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="139" x="1410.75" y="632.6543">SSLWSPeer&lt;Handler&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1231.5" x2="1696.5" y1="644.5" y2="644.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="308" x="1236.5" y="658.7104">std::unique_ptr&lt;beast::asio::ssl_bundle&gt; ssl_bundle_</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="455" x="1236.5" y="671.5151">boost::beast::websocket::stream&lt;beast::asio::ssl_bundle::stream_type&amp;&gt; ws_</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1231.5" x2="1696.5" y1="678.1094" y2="678.1094"/><!--class PlainWSPeer<Handler>--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="60.8047" id="PlainWSPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="401" x="1732.5" y="619"/><ellipse cx="1855.25" cy="635" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1858.2188,640.6406 Q1857.6406,640.9375 1857,641.0781 Q1856.3594,641.2344 1855.6563,641.2344 Q1853.1563,641.2344 1851.8281,639.5938 Q1850.5156,637.9375 1850.5156,634.8125 Q1850.5156,631.6875 1851.8281,630.0313 Q1853.1563,628.375 1855.6563,628.375 Q1856.3594,628.375 1857,628.5313 Q1857.6563,628.6875 1858.2188,628.9844 L1858.2188,631.7031 Q1857.5938,631.125 1857,630.8594 Q1856.4063,630.5781 1855.7813,630.5781 Q1854.4375,630.5781 1853.75,631.6563 Q1853.0625,632.7188 1853.0625,634.8125 Q1853.0625,636.9063 1853.75,637.9844 Q1854.4375,639.0469 1855.7813,639.0469 Q1856.4063,639.0469 1857,638.7813 Q1857.5938,638.5 1858.2188,637.9219 L1858.2188,640.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="1875.75" y="639.1543">PlainWSPeer&lt;Handler&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1733.5" x2="2132.5" y1="651" y2="651"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="389" x="1738.5" y="665.2104">boost::beast::websocket::stream&lt;boost::asio::ip::tcp::socket&gt; ws_;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1733.5" x2="2132.5" y1="671.8047" y2="671.8047"/><polygon fill="#FBFB77" filter="url(#f16tdukpljcqty)" points="1358.5,400,1358.5,440.2656,1853.5,440.2656,1853.5,410,1843.5,400,1358.5,400" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1843.5" x2="1843.5" y1="400" y2="410"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1853.5" x2="1843.5" y1="410" y2="410"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="374" x="1364.5" y="417.0669">io_list keeps a collection of pointers to io_list::work objects,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="474" x="1364.5" y="432.1997">while the io_list::work objects have a pointer to the containing io_list object</text><!--class Session--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="99.2188" id="Session" style="stroke: #A80036; stroke-width: 1.5;" width="325" x="427.5" y="154"/><ellipse cx="561.25" cy="170" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M564.2188,175.6406 Q563.6406,175.9375 563,176.0781 Q562.3594,176.2344 561.6563,176.2344 Q559.1563,176.2344 557.8281,174.5938 Q556.5156,172.9375 556.5156,169.8125 Q556.5156,166.6875 557.8281,165.0313 Q559.1563,163.375 561.6563,163.375 Q562.3594,163.375 563,163.5313 Q563.6563,163.6875 564.2188,163.9844 L564.2188,166.7031 Q563.5938,166.125 563,165.8594 Q562.4063,165.5781 561.7813,165.5781 Q560.4375,165.5781 559.75,166.6563 Q559.0625,167.7188 559.0625,169.8125 Q559.0625,171.9063 559.75,172.9844 Q560.4375,174.0469 561.7813,174.0469 Q562.4063,174.0469 563,173.7813 Q563.5938,173.5 564.2188,172.9219 L564.2188,175.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="49" x="581.75" y="174.1543">Session</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="428.5" x2="751.5" y1="186" y2="186"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="428.5" x2="751.5" y1="194" y2="194"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="433.5" y="208.2104">write() = 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="84" x="433.5" y="221.0151">complete() = 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="433.5" y="233.8198">close() = 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="313" x="433.5" y="246.6245">std::shared_ptr&lt;WSSession&gt; websocketUpgrade() = 0</text><!--class WSSession--><rect fill="#FEFECE" filter="url(#f16tdukpljcqty)" height="99.2188" id="WSSession" style="stroke: #A80036; stroke-width: 1.5;" width="209" x="1129.5" y="154"/><ellipse cx="1195.75" cy="170" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1198.7188,175.6406 Q1198.1406,175.9375 1197.5,176.0781 Q1196.8594,176.2344 1196.1563,176.2344 Q1193.6563,176.2344 1192.3281,174.5938 Q1191.0156,172.9375 1191.0156,169.8125 Q1191.0156,166.6875 1192.3281,165.0313 Q1193.6563,163.375 1196.1563,163.375 Q1196.8594,163.375 1197.5,163.5313 Q1198.1563,163.6875 1198.7188,163.9844 L1198.7188,166.7031 Q1198.0938,166.125 1197.5,165.8594 Q1196.9063,165.5781 1196.2813,165.5781 Q1194.9375,165.5781 1194.25,166.6563 Q1193.5625,167.7188 1193.5625,169.8125 Q1193.5625,171.9063 1194.25,172.9844 Q1194.9375,174.0469 1196.2813,174.0469 Q1196.9063,174.0469 1197.5,173.7813 Q1198.0938,173.5 1198.7188,172.9219 L1198.7188,175.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="68" x="1216.25" y="174.1543">WSSession</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1130.5" x2="1337.5" y1="186" y2="186"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="197" x="1135.5" y="200.2104">std::shared_ptr&lt;void&gt; appDefined</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1130.5" x2="1337.5" y1="206.8047" y2="206.8047"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="60" x="1135.5" y="221.0151">send() = 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="62" x="1135.5" y="233.8198">close() = 0</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="84" x="1135.5" y="246.6245">complete() = 0</text><polygon fill="#FBFB77" filter="url(#f16tdukpljcqty)" points="840.5,637,840.5,662.1328,1123.5,662.1328,1123.5,647,1113.5,637,840.5,637" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1113.5" x2="1113.5" y1="637" y2="647"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1123.5" x2="1113.5" y1="647" y2="647"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="846.5" y="654.0669">Impl template parameter is derived class</text><!--link io_list::work to io_list--><path d="M1315.9604,82.3632 C1358.4268,103.1868 1415.0373,130.946 1463.352,154.6372 " fill="none" id="io_list::work-io_list" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1475.1212,160.4083,1471.4951,154.1752,1464.3469,155.125,1467.9729,161.3581,1475.1212,160.4083" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1304.0544,76.5251,1307.6805,82.7582,1314.8287,81.8084,1311.2027,75.5753,1304.0544,76.5251" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BaseHTTPPeer<Handler,Impl> to N1--><path d="M424.3622,495.1751 C393.315,559.6483 365.1188,651.4589 415,712 C441.2287,743.834 530.9913,761.876 615.7658,771.9998 " fill="none" id="BaseHTTPPeer&lt;Handler,Impl&gt;-N1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link PlainHTTPPeer<Handler> to N1--><path d="M667.7421,705.5793 C704.743,730.0652 744.8645,756.6162 767.8612,771.8346 " fill="none" id="PlainHTTPPeer&lt;Handler&gt;-N1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link SSLHTTPPeer<Handler> to N1--><path d="M326.1806,704.845 C335.2139,707.4005 344.1977,709.8082 353,712 C464.9331,739.8713 595.8155,760.0871 684.3497,771.9816 " fill="none" id="SSLHTTPPeer&lt;Handler&gt;-N1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link BasePeer<Handler,Impl> to N1--><path d="M925.8566,246.7433 C901.5735,317.2792 853.5579,461.8038 823,587 C806.1407,656.0727 793.2906,740.4752 788.7658,771.9138 " fill="none" id="BasePeer&lt;Handler,Impl&gt;-N1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link BaseWSPeer<Handler,Impl> to N1--><path d="M1199.7977,527.274 C1199.3562,589.0766 1187.489,663.8186 1141,712 C1111.2705,742.8118 1012.6006,761.3778 926.961,771.9971 " fill="none" id="BaseWSPeer&lt;Handler,Impl&gt;-N1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link SSLWSPeer<Handler> to N1--><path d="M1316.3246,686.5621 C1279.4154,695.3561 1239.8457,704.3854 1203,712 C1087.0531,735.9617 951.8374,758.5443 867.8097,771.9514 " fill="none" id="SSLWSPeer&lt;Handler&gt;-N1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link PlainWSPeer<Handler> to N1--><path d="M1841.9506,680.0347 C1803.233,691.8571 1757.3297,704.359 1715,712 C1574.4556,737.3697 1185.612,762.2677 958.332,775.2517 " fill="none" id="PlainWSPeer&lt;Handler&gt;-N1" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link io_list to N2--><path d="M1571.5468,246.5323 C1580.7805,293.0225 1595.0959,365.0992 1602.0031,399.8762 " fill="none" id="io_list-N2" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link io_list::work to N2--><path d="M1304.0217,53.2838 C1423.4108,59.7266 1711.3203,82.5036 1770,154 C1839.0095,238.0825 1699.3233,353.624 1635.5128,399.77 " fill="none" id="io_list::work-N2" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link Session to BaseHTTPPeer<Handler,Impl>--><path d="M552.0758,270.7999 C538.8815,294.2144 523.9978,320.6268 510.4603,344.6504 " fill="none" id="Session-BaseHTTPPeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="546.0937,267.1569,562.0107,253.1695,558.2905,274.03,546.0937,267.1569" style="stroke: #A80036; stroke-width: 1.0;"/><!--link io_list::work to BaseHTTPPeer<Handler,Impl>--><path d="M1179.4781,54.4662 C984.5787,64.5187 460.7418,96.6728 410,154 C363.8708,206.1159 389.9975,286.2842 420.5194,344.9911 " fill="none" id="io_list::work-BaseHTTPPeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1179.3726,47.4627,1199.7011,53.4419,1180.0808,61.4447,1179.3726,47.4627" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BaseHTTPPeer<Handler,Impl> to PlainHTTPPeer<Handler>--><path d="M514.6958,513.1885 C528.3399,540.4174 542.8259,569.3265 554.9299,593.4818 " fill="none" id="BaseHTTPPeer&lt;Handler,Impl&gt;-PlainHTTPPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="508.3569,516.1636,505.6553,495.1469,520.8735,509.8917,508.3569,516.1636" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BaseHTTPPeer<Handler,Impl> to SSLHTTPPeer<Handler>--><path d="M352.832,507.52 C318.0701,533.9368 280.6194,562.3968 248.4418,586.8497 " fill="none" id="BaseHTTPPeer&lt;Handler,Impl&gt;-SSLHTTPPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="348.9548,501.6746,369.1139,495.1469,357.4255,512.8212,348.9548,501.6746" style="stroke: #A80036; stroke-width: 1.0;"/><!--link io_list::work to BasePeer<Handler,Impl>--><path d="M1181.7813,85.432 C1136.5068,107.6325 1077.268,136.6805 1028.8788,160.4083 " fill="none" id="io_list::work-BasePeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1178.9064,79.0455,1199.9456,76.5251,1185.0702,91.6156,1178.9064,79.0455" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BasePeer<Handler,Impl> to BaseWSPeer<Handler,Impl>--><path d="M1005.7828,259.8272 C1024.7279,276.2996 1046.0906,294.8739 1067.3799,313.3846 " fill="none" id="BasePeer&lt;Handler,Impl&gt;-BaseWSPeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1000.9919,264.9376,990.4921,246.5323,1010.1779,254.3727,1000.9919,264.9376" style="stroke: #A80036; stroke-width: 1.0;"/><!--link WSSession to BaseWSPeer<Handler,Impl>--><path d="M1219.877,272.9914 C1217.2929,285.7065 1214.5417,299.2436 1211.7948,312.7596 " fill="none" id="WSSession-BaseWSPeer&lt;Handler,Impl&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1213.0624,271.3746,1223.9055,253.1695,1226.782,274.163,1213.0624,271.3746" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BaseWSPeer<Handler,Impl> to PlainWSPeer<Handler>--><path d="M1330.7527,522.5483 C1334.1614,524.1153 1337.5794,525.6028 1341,527 C1496.8482,590.6575 1550.6784,550.4028 1715,587 C1754.9676,595.9015 1798.44,607.8854 1835.9734,618.9783 " fill="none" id="BaseWSPeer&lt;Handler,Impl&gt;-PlainWSPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1327.3916,528.6937,1312.6497,513.4726,1333.6659,516.1784,1327.3916,528.6937" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BaseWSPeer<Handler,Impl> to SSLWSPeer<Handler>--><path d="M1328.2911,535.8315 C1361.4196,563.5796 1394.4474,591.2433 1419.625,612.3319 " fill="none" id="BaseWSPeer&lt;Handler,Impl&gt;-SSLWSPeer&lt;Handler&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1323.4121,540.8759,1312.5746,522.6674,1332.4017,530.1433,1323.4121,540.8759" style="stroke: #A80036; stroke-width: 1.0;"/><!--link BaseHTTPPeer<Handler,Impl> to N3--><path d="M621.5207,488.5467 C739.256,541.1153 891.7741,609.2143 953.8555,636.9335 " fill="none" id="BaseHTTPPeer&lt;Handler,Impl&gt;-N3" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link BaseWSPeer<Handler,Impl> to N3--><path d="M1093.0031,527.023 C1053.6043,570.4943 1012.8591,615.4511 993.5224,636.7866 " fill="none" id="BaseWSPeer&lt;Handler,Impl&gt;-N3" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--link BasePeer<Handler,Impl> to N3--><path d="M944.9685,246.6696 C953.9718,344.6074 975.5716,579.5711 980.8308,636.7817 " fill="none" id="BasePeer&lt;Handler,Impl&gt;-N3" style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 7.0,7.0;"/><!--
@startuml

class io_list {
boost::container::flat_map<work*, std::weak_ptr<work>> map_

emplace()
close()
}

class "io_list::work" {
io_list* ios_

io_list& ios()
void close() = 0
}






"io_list::work" *- -* io_list

note "Handler template parameter is ServerHandlerImpl" as N1


"BaseHTTPPeer<Handler,Impl>" .. N1
"PlainHTTPPeer<Handler>" .. N1
"SSLHTTPPeer<Handler>" .. N1
"BasePeer<Handler,Impl>" .. N1
"BaseWSPeer<Handler,Impl>" .. N1
"SSLWSPeer<Handler>" .. N1
"PlainWSPeer<Handler>" .. N1

note as N2
io_list keeps a collection of pointers to io_list::work objects,
while the io_list::work objects have a pointer to the containing io_list object
end note

io_list .. N2
"io_list::work" .. N2

'SESSION OBJECTS

class Session {
write() = 0
complete() = 0
close() = 0
std::shared_ptr<WSSession> websocketUpgrade() = 0
}

class "BaseHTTPPeer<Handler,Impl>" {
Handler& handler_
boost::asio::strand<boost::asio::executor> strand_
write()
do_read()
complete()
close()
do_request() = 0
do_close() = 0
}

class "PlainHTTPPeer<Handler>" {
boost::asio::ip::tcp::socket stream_
run()
std::shared_ptr<WSSession> websocketUpgrade()
do_request()
do_close()
}

class "SSLHTTPPeer<Handler>" {
boost::asio::ip::tcp::socket& stream_
std::unique_ptr<boost::asio::ssl_bundle> ssl_bundle_

do_handshake()
do_request()
do_close()
on_shutdown()
}

class "BasePeer<Handler,Impl>" {
Handler& handler_
boost::asio::strand<boost::asio::executor> strand_
close()
}

class WSSession {
std::shared_ptr<void> appDefined
send() = 0
close() = 0
complete() = 0
}

class "BaseWSPeer<Handler,Impl>" {
boost::beast::multi_buffer rb_
boost::beast::multi_buffer wb_
std::list<std::shared_ptr<WSMsg>> wq_

run()
send()
close()
complete()
on_ws_handshake()
do_write()
do_read()
on_write()
on_read()
on_close()
}

class "PlainWSPeer<Handler>" {
boost::beast::websocket::stream<boost::asio::ip::tcp::socket> ws_;
}

class "SSLWSPeer<Handler>" {
std::unique_ptr<beast::asio::ssl_bundle> ssl_bundle_
boost::beast::websocket::stream<beast::asio::ssl_bundle::stream_type&> ws_
}

Session <|- - "BaseHTTPPeer<Handler,Impl>"
"io_list::work" <|- - "BaseHTTPPeer<Handler,Impl>"
"BaseHTTPPeer<Handler,Impl>" <|- - "PlainHTTPPeer<Handler>"
"BaseHTTPPeer<Handler,Impl>" <|- - "SSLHTTPPeer<Handler>"


"io_list::work" <|- - "BasePeer<Handler,Impl>"

"BasePeer<Handler,Impl>" <|- - "BaseWSPeer<Handler,Impl>"
WSSession <|- - "BaseWSPeer<Handler,Impl>"

"BaseWSPeer<Handler,Impl>" <|- - "PlainWSPeer<Handler>"
"BaseWSPeer<Handler,Impl>" <|- - "SSLWSPeer<Handler>"


note "Impl template parameter is derived class" as N3

"BaseHTTPPeer<Handler,Impl>" .. N3
"BaseWSPeer<Handler,Impl>" .. N3
"BasePeer<Handler,Impl>" .. N3

@enduml

PlantUML version 1.2017.15(Mon Jul 03 09:45:34 PDT 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.5+10-post-Ubuntu-0ubuntu1.118.04
Operating System: Linux
OS Version: 5.3.2-050302-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>