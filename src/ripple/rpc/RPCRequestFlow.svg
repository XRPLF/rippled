<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1528px" preserveAspectRatio="none" style="width:939px;height:1528px;" version="1.1" viewBox="0 0 939 1528" width="939px" zoomAndPan="magnify"><defs><filter height="300%" id="faax543avhvlx" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="242" x="359.5" y="16.708">Flow of Request Processing</text><ellipse cx="352" cy="38.9531" fill="#000000" filter="url(#faax543avhvlx)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="225" x="239.5" y="89.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="109" x="295.5" y="111.0918">Door.do_accept()</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="201" x="253.5" y="125.0605">Execution via Door's asio strand</text><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="352,178.9531,364,190.9531,352,202.9531,340,190.9531,352,178.9531" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="235" x="309.5" y="276.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="215" x="319.5" y="298.0918">detect protocol via Door::Detector</text><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="374,376.9531,386,388.9531,374,400.9531,362,388.9531,374,376.9531" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="234" x="257" y="466.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="171" x="286.5" y="488.0918">Create SSLHTTPPeer object</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="210" x="271" y="502.0605">Execution via object's asio strand</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="234" x="450" y="364.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="179" x="475.5" y="386.0918">Create PlainHTTPPeer object</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="210" x="464" y="400.0605">Execution via object's asio strand</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="210" x="182" y="222.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="190" x="192" y="244.0918">Listening for only one protocol</text><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="330,376.9531,342,388.9531,330,400.9531,318,388.9531,330,376.9531" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="355.5" y="555.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="97" x="365.5" y="577.0918">SSL Handshake</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="390" y="643.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="140" x="400" y="665.0918">read data from socket</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="427" x="291.5" y="718.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="407" x="301.5" y="740.0918">check for WebSocket upgrade via ServerHandlerImpl.onHandoff()</text><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="579,798.9531,591,810.9531,579,822.9531,567,810.9531,579,798.9531" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="191" x="483.5" y="881.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="171" x="493.5" y="903.0918">create Web Socket session</text><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="604,974.9531,616,986.9531,604,998.9531,592,986.9531,604,974.9531" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="263" x="517.5" y="1091.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="158" x="568" y="1113.0918">create SSLWSPeer object</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="239" x="531.5" y="1127.0605">Execution via new object's asio strand</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="645" y="1180.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="148" x="655" y="1202.0918">Web Socket handshake</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="263" x="600.5" y="1023.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="166" x="647" y="1045.0918">create PlainWSPeer object</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="239" x="614.5" y="1059.0605">Execution via new object's asio strand</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="222" x="618" y="1408.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="202" x="628" y="1430.0918">Read next Web Socket message</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="239" x="689.5" y="1483.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="219" x="699.5" y="1505.0918">ServerHandlerImpl.onWSMessage()</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="193" x="694.5" y="881.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="173" x="704.5" y="903.0918">post coroutine to JobQueue</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="216" x="662" y="793.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="196" x="672" y="815.0918">ServerHandlerImpl.onRequest()</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="381" x="191.5" y="969.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="361" x="201.5" y="991.0918">(Execution passes from object's asio strand to JobQueue)</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="250" x="247" y="1098.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="230" x="257" y="1120.0918">Process request. Populate response</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="415" x="191.5" y="1180.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="395" x="201.5" y="1202.0918">(Execution passes from JobQueue back to object's asio strand)</text><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="115" x="247.5" y="1255.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="95" x="257.5" y="1277.0918">Send response</text><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="182,1330.9531,194,1342.9531,182,1354.9531,170,1342.9531,182,1330.9531" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="182,1413.9531,194,1425.9531,182,1437.9531,170,1425.9531,182,1413.9531" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" filter="url(#faax543avhvlx)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="20.5" y="555.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="79" x="30.5" y="577.0918">close socket</text><ellipse cx="50" cy="660.9531" fill="none" filter="url(#faax543avhvlx)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="50.5" cy="661.4531" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><polygon fill="#FEFECE" filter="url(#faax543avhvlx)" points="233,560.9531,245,572.9531,233,584.9531,221,572.9531,233,560.9531" style="stroke: #A80036; stroke-width: 1.5;"/><!--link start to Door.do_accept() \n Execution via Door's asio strand--><path d="M352,49.0679 C352,58.1643 352,71.9875 352,84.5411 " fill="none" id="start-Door.do_accept() \n Execution via Door's asio strand" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="352,89.826,356,80.826,352,84.826,348,80.826,352,89.826" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Door.do_accept() \n Execution via Door's asio strand to #5--><path d="M352,138.3164 C352,149.7223 352,163.0507 352,173.4415 " fill="none" id="Door.do_accept() \n Execution via Door's asio strand-#5" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="352,178.5817,356,169.5817,352,173.5817,348,169.5817,352,178.5817" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="308" x="24.2688" y="174.4899">Is Door listening for both SSL and Non-SSL Requests?</text><!--link #5 to detect protocol via Door::Detector--><path d="M360.2288,194.8099 C370.3696,199.9375 387.5387,209.8936 398,222.9531 C409.5177,237.3313 417.0565,256.907 421.553,271.8621 " fill="none" id="#5-detect protocol via Door::Detector" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="422.9627,276.7425,424.3082,266.986,421.5753,271.9389,416.6224,269.2059,422.9627,276.7425" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="416" y="244.1636">true</text><!--link detect protocol via Door::Detector to #10--><path d="M408.3651,311.1501 C402.8297,317.0091 397.1447,323.8772 393,330.9531 C385.1275,344.3933 380.0313,361.5224 377.1187,373.6724 " fill="none" id="detect protocol via Door::Detector-#10" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="376.0024,378.5494,381.9096,370.6687,377.118,373.6755,374.1112,368.8838,376.0024,378.5494" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="382.654" y="366.159"/><!--link #10 to Create SSLHTTPPeer object \n Execution via object's asio strand--><path d="M374,401.0544 C374,415.8777 374,441.495 374,461.6008 " fill="none" id="#10-Create SSLHTTPPeer object \n Execution via object's asio strand" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="374,466.8471,378,457.8471,374,461.8471,370,457.8471,374,466.8471" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="17" x="375" y="444.1636">ssl</text><!--link #10 to Create PlainHTTPPeer object \n Execution via object's asio strand--><path d="M386.073,388.9531 C398.8623,388.9531 420.4859,388.9531 444.4239,388.9531 " fill="none" id="#10-Create PlainHTTPPeer object \n Execution via object's asio strand" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="449.5648,388.9531,440.5648,384.9531,444.5648,388.9531,440.5648,392.9531,449.5648,388.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="42" x="397" y="383.1636">non-ssl</text><!--link #5 to Listening for only one protocol--><path d="M345.0439,196.197 C337.5768,201.826 325.2498,211.1187 313.872,219.6958 " fill="none" id="#5-Listening for only one protocol" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="309.7338,222.8153,319.3283,220.5916,313.7264,219.8055,314.5126,214.2035,309.7338,222.8153" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="298.2936" y="206.7884">false</text><!--link Listening for only one protocol to #19--><path d="M288.8692,257.1028 C290.6953,271.6229 293.9466,292.895 299,310.9531 C305.5624,334.4033 316.7667,360.4749 323.7564,375.7531 " fill="none" id="Listening for only one protocol-#19" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="325.9525,380.5013,325.8048,370.6536,323.8535,375.9632,318.5439,374.0119,325.9525,380.5013" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="0" x="320.6609" y="366.4185"/><!--link #19 to Create SSLHTTPPeer object \n Execution via object's asio strand--><path d="M332.7791,398.5836 C336.2675,410.2467 342.6877,430.388 350,446.9531 C352.2061,451.9507 354.7735,457.1433 357.3924,462.1348 " fill="none" id="#19-Create SSLHTTPPeer object \n Execution via object's asio strand" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="359.8031,466.6508,359.0936,456.8276,357.4485,462.2399,352.0361,460.5949,359.8031,466.6508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="17" x="351" y="444.1636">ssl</text><!--link Create SSLHTTPPeer object \n Execution via object's asio strand to SSL Handshake--><path d="M385.785,515.1123 C391.3503,526.5213 397.9429,540.036 403.3554,551.1317 " fill="none" id="Create SSLHTTPPeer object \n Execution via object's asio strand-SSL Handshake" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="405.5964,555.7257,405.2456,545.8831,403.4043,551.2319,398.0555,549.3905,405.5964,555.7257" style="stroke: #A80036; stroke-width: 1.0;"/><!--link SSL Handshake to read data from socket--><path d="M425.0638,590.3391 C434.0187,604.4111 446.6757,624.3007 456.276,639.3868 " fill="none" id="SSL Handshake-read data from socket" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="459.1497,643.9027,457.6924,634.1623,456.4653,639.6844,450.9431,638.4574,459.1497,643.9027" style="stroke: #A80036; stroke-width: 1.0;"/><!--link #19 to Create PlainHTTPPeer object \n Execution via object's asio strand--><path d="M335.2896,382.0998 C339.464,376.9787 345.6285,370.0181 352,364.9531 C370.3833,350.3394 375.2885,344.9274 398,338.9531 C440.9037,327.6671 489.4195,345.2038 523.4279,362.535 " fill="none" id="#19-Create PlainHTTPPeer object \n Execution via object's asio strand" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="527.9191,364.8655,521.773,357.1698,523.481,362.5626,518.0882,364.2707,527.9191,364.8655" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="42" x="399" y="342.1636">non-ssl</text><!--link Create PlainHTTPPeer object \n Execution via object's asio strand to read data from socket--><path d="M558.3919,413.0913 C539.744,465.3824 495.8509,588.4639 477.8806,638.8548 " fill="none" id="Create PlainHTTPPeer object \n Execution via object's asio strand-read data from socket" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="476.1229,643.7836,482.9137,636.6503,477.8025,639.0742,475.3786,633.9629,476.1229,643.7836" style="stroke: #A80036; stroke-width: 1.0;"/><!--link read data from socket to check for WebSocket upgrade via ServerHandlerImpl.onHandoff()--><path d="M477.942,677.9718 C482.9187,688.6361 489.383,702.4881 494.7452,713.9785 " fill="none" id="read data from socket-check for WebSocket upgrade via ServerHandlerImpl.onHandoff()" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="496.9682,718.7422,496.787,708.895,494.8538,714.2113,489.5375,712.2781,496.9682,718.7422" style="stroke: #A80036; stroke-width: 1.0;"/><!--link check for WebSocket upgrade via ServerHandlerImpl.onHandoff() to #31--><path d="M521.7917,752.9718 C536.3503,767.727 556.93,788.5849 569.0278,800.8461 " fill="none" id="check for WebSocket upgrade via ServerHandlerImpl.onHandoff()-#31" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="572.7844,804.6535,569.3106,795.4376,569.2727,801.0944,563.6159,801.0564,572.7844,804.6535" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="133" x="425.923" y="800.5961">Is Web Socket request?</text><!--link #31 to create Web Socket session--><path d="M579,823.1891 C579,836.9704 579,859.6536 579,876.6148 " fill="none" id="#31-create Web Socket session" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="579,881.6787,583,872.6787,579,876.6787,575,872.6787,579,881.6787" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="580" y="859.1636">true</text><!--link create Web Socket session to #36--><path d="M583.9392,916.3391 C588.5929,932.7199 595.486,956.9839 599.8592,972.3775 " fill="none" id="create Web Socket session-#36" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="601.2388,977.2337,602.6269,967.4832,599.8723,972.4241,594.9315,969.6695,601.2388,977.2337" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="42" x="614.2339" y="964.5308">is SSL?</text><!--link #36 to create SSLWSPeer object \n Execution via new object's asio strand--><path d="M597.1269,992.5055 C587.09,1000.7891 569.2581,1016.2333 566,1023.9531 C557.7049,1043.6077 555.0012,1053.6737 566,1071.9531 C569.8259,1078.3115 574.9137,1083.7997 580.6941,1088.526 " fill="none" id="#36-create SSLWSPeer object \n Execution via new object's asio strand" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="584.7995,1091.6778,580.0966,1083.0243,580.8335,1088.633,575.2249,1089.3699,584.7995,1091.6778" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="23" x="567" y="1052.1636">true</text><!--link create SSLWSPeer object \n Execution via new object's asio strand to Web Socket handshake--><path d="M672.5699,1140.1123 C683.9988,1151.8269 697.5936,1165.7615 708.5756,1177.018 " fill="none" id="create SSLWSPeer object \n Execution via new object's asio strand-Web Socket handshake" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="712.1928,1180.7257,708.771,1171.4904,708.7012,1177.1468,703.0448,1177.077,712.1928,1180.7257" style="stroke: #A80036; stroke-width: 1.0;"/><!--link #36 to create PlainWSPeer object \n Execution via new object's asio strand--><path d="M612.3984,990.9555 C625.5406,997.2186 652.0264,1009.8407 676.7402,1021.6184 " fill="none" id="#36-create PlainWSPeer object \n Execution via new object's asio strand" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="681.3306,1023.806,674.9271,1016.3231,676.817,1021.6549,671.4852,1023.5448,681.3306,1023.806" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="618.0338" y="1004.6719">false</text><!--link create PlainWSPeer object \n Execution via new object's asio strand to Web Socket handshake--><path d="M774.7139,1071.9765 C781.2901,1077.6404 787.1609,1084.301 791,1091.9531 C800.5665,1111.0212 799.4911,1120.3824 791,1139.9531 C784.5169,1154.8957 772.0778,1167.7454 760.0329,1177.5247 " fill="none" id="create PlainWSPeer object \n Execution via new object's asio strand-Web Socket handshake" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="755.9724,1180.7221,765.518,1178.2968,759.9007,1177.6288,760.5687,1172.0116,755.9724,1180.7221" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Web Socket handshake to Read next Web Socket message--><path d="M729,1215.0902 C729,1255.7927 729,1358.257 729,1403.6796 " fill="none" id="Web Socket handshake-Read next Web Socket message" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="729,1408.9282,733,1399.9282,729,1403.9282,725,1399.9282,729,1408.9282" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Read next Web Socket message to ServerHandlerImpl.onWSMessage()--><path d="M747.1532,1442.9718 C758.9347,1454.0169 774.3638,1468.4816 786.8637,1480.2003 " fill="none" id="Read next Web Socket message-ServerHandlerImpl.onWSMessage()" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="790.6417,1483.7422,786.8116,1474.6686,786.994,1480.3225,781.3401,1480.5049,790.6417,1483.7422" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ServerHandlerImpl.onWSMessage() to post coroutine to JobQueue--><path d="M839.9351,1483.8925 C859.0681,1470.845 880,1450.8757 880,1425.9531 C880,986.9531 880,986.9531 880,986.9531 C880,956.9851 854.1691,933.766 830.3393,918.7219 " fill="none" id="ServerHandlerImpl.onWSMessage()-post coroutine to JobQueue" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="825.9197,916.0082,831.4962,924.1262,830.1806,918.6245,835.6823,917.3089,825.9197,916.0082" style="stroke: #A80036; stroke-width: 1.0;"/><!--link #31 to ServerHandlerImpl.onRequest()--><path d="M591.2385,810.9531 C605.2869,810.9531 629.8247,810.9531 656.3005,810.9531 " fill="none" id="#31-ServerHandlerImpl.onRequest()" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="661.619,810.9531,652.619,806.9531,656.619,810.9531,652.619,814.9531,661.619,810.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="28" x="612.5" y="805.1636">false</text><!--link ServerHandlerImpl.onRequest() to post coroutine to JobQueue--><path d="M774.1489,828.3391 C777.4781,842.2898 782.1717,861.9582 785.7601,876.9955 " fill="none" id="ServerHandlerImpl.onRequest()-post coroutine to JobQueue" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="786.9312,881.9027,788.7327,872.22,785.7705,877.0393,780.9512,874.0772,786.9312,881.9027" style="stroke: #A80036; stroke-width: 1.0;"/><!--link post coroutine to JobQueue to (Execution passes from object's asio strand to JobQueue)--><path d="M711.6557,916.0247 C641.1026,931.2049 538.256,953.3332 466.2535,968.8252 " fill="none" id="post coroutine to JobQueue-(Execution passes from object's asio strand to JobQueue)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="461.1235,969.929,470.7635,971.9465,466.0116,968.8773,469.0808,964.1254,461.1235,969.929" style="stroke: #A80036; stroke-width: 1.0;"/><!--link (Execution passes from object's asio strand to JobQueue) to Process request. Populate response--><path d="M380.6721,1004.0833 C378.8865,1027.1179 375.7083,1068.1163 373.7352,1093.5688 " fill="none" id="(Execution passes from object's asio strand to JobQueue)-Process request. Populate response" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="373.3334,1098.752,378.0173,1090.0882,373.72,1093.767,370.0412,1089.4697,373.3334,1098.752" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Process request. Populate response to (Execution passes from JobQueue back to object's asio strand)--><path d="M377.726,1133.3432 C381.8344,1145.8206 387.4,1162.7234 391.808,1176.1108 " fill="none" id="Process request. Populate response-(Execution passes from JobQueue back to object's asio strand)" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="393.3748,1180.8693,394.3592,1171.0698,391.8109,1176.1202,386.7605,1173.572,393.3748,1180.8693" style="stroke: #A80036; stroke-width: 1.0;"/><!--link (Execution passes from JobQueue back to object's asio strand) to Send response--><path d="M377.6699,1214.9718 C363.7073,1226.1121 345.3847,1240.7313 330.6311,1252.5028 " fill="none" id="(Execution passes from JobQueue back to object's asio strand)-Send response" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="326.571,1255.7422,336.1008,1253.2558,330.4794,1252.6238,331.1114,1247.0024,326.571,1255.7422" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Send response to #63--><path d="M274.9108,1290.077 C249.1672,1304.7279 213.3861,1325.0911 194.6267,1335.7672 " fill="none" id="Send response-#63" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="189.8095,1338.5087,199.61,1337.5335,194.155,1336.0356,195.653,1330.5807,189.8095,1338.5087" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="85" x="202.0724" y="1334.2714">Is Web Socket?</text><!--link #63 to #66--><path d="M182,1355.2 C182,1369.3798 182,1392.8302 182,1408.8152 " fill="none" id="#63-#66" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="182,1413.9258,186,1404.9258,182,1408.9258,178,1404.9258,182,1413.9258" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="64" x="183" y="1386.1636">web socket</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="161" x="1.3781" y="1407.8402">Connection closed by client?</text><!--link #66 to close socket--><path d="M172.9419,1422.7323 C149.9245,1413.9041 91,1387.0022 91,1342.9531 C91,660.9531 91,660.9531 91,660.9531 C91,637.982 84.1462,612.5365 78.2696,594.9409 " fill="none" id="#66-close socket" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="76.6445,590.1948,75.7757,600.0053,78.2642,594.9252,83.3443,597.4137,76.6445,590.1948" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="37" x="92" y="991.1636">closed</text><!--link close socket to end--><path d="M66.0486,590.3391 C62.3666,606.5399 56.9322,630.4516 53.4287,645.8668 " fill="none" id="close socket-end" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="52.3199,650.7455,58.2151,642.8558,53.428,645.8699,50.414,641.0828,52.3199,650.7455" style="stroke: #A80036; stroke-width: 1.0;"/><!--link #66 to Read next Web Socket message--><path d="M194.1918,1425.9531 C248.5468,1425.9531 472.2569,1425.9531 612.558,1425.9531 " fill="none" id="#66-Read next Web Socket message" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="617.9283,1425.9531,608.9283,1421.9531,612.9283,1425.9531,608.9283,1429.9531,617.9283,1425.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="59" x="376.5" y="1420.1636">not closed</text><!--link #63 to #74--><path d="M177.951,1334.9964 C171.8486,1322.2472 161,1296.2988 161,1272.9531 C161,660.9531 161,660.9531 161,660.9531 C161,623.5153 200.5173,593.2498 220.9995,580.0773 " fill="none" id="#63-#74" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="225.2947,577.3861,215.5443,578.775,221.0577,580.0409,219.7918,585.5543,225.2947,577.3861" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="86" x="162" y="947.1636">not web socket</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="78" x="134.7427" y="590.5086">Is Keep Alive?</text><!--link #74 to read data from socket--><path d="M242.0013,576.2953 C270.621,586.9221 361.0479,620.4983 419.0517,642.0356 " fill="none" id="#74-read data from socket" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="423.8647,643.8227,416.8199,636.9401,419.1774,642.0823,414.0352,644.4398,423.8647,643.8227" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="367" y="621.1636">Keep Alive</text><!--link close socket to #74--><path d="M124.7997,572.9531 C159.1191,572.9531 200.5398,572.9531 220.7318,572.9531 " fill="none" id="close socket-#74" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="119.7911,572.9531,128.7911,576.9531,124.7911,572.9531,128.7911,568.9531,119.7911,572.9531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="80" x="130.25" y="567.1636">not Keep Alive</text><!--
@startuml
title Flow of Request Processing

(*) - -> "Door.do_accept() \n Execution via Door's asio strand"
if "Is Door listening for both SSL and Non-SSL Requests?" then
- ->[true] "detect protocol via Door::Detector"
if "" then
- ->[ssl] "Create SSLHTTPPeer object \n Execution via object's asio strand"
else
->[non-ssl] "Create PlainHTTPPeer object \n Execution via object's asio strand"
endif
else
->[false] "Listening for only one protocol"
if "" then
- ->[ssl] "Create SSLHTTPPeer object \n Execution via object's asio strand"
- -> "SSL Handshake"
- -> "read data from socket"
else
->[non-ssl] "Create PlainHTTPPeer object \n Execution via object's asio strand"
- -> "read data from socket"
- -> "check for WebSocket upgrade via ServerHandlerImpl.onHandoff()"
if "Is Web Socket request?" then
- ->[true] "create Web Socket session"
if "is SSL?" then
- ->[true] "create SSLWSPeer object \n Execution via new object's asio strand"
- -> "Web Socket handshake"
else
->[false] "create PlainWSPeer object \n Execution via new object's asio strand"
- -> "Web Socket handshake"
- -> "Read next Web Socket message"
- -> "ServerHandlerImpl.onWSMessage()"
- -> "post coroutine to JobQueue"
endif
else
->[false] "ServerHandlerImpl.onRequest()"
- -> "post coroutine to JobQueue"
- -> "(Execution passes from object's asio strand to JobQueue)"
- -> "Process request. Populate response"
- -> "(Execution passes from JobQueue back to object's asio strand)"
- -> "Send response"
if "Is Web Socket?" then
- ->[web socket] if "Connection closed by client?" then
- ->[closed] "close socket"
- ->(*)
else
->[not closed] "Read next Web Socket message"
endif
else
->[not web socket] if "Is Keep Alive?" then
- ->[Keep Alive] "read data from socket"
else
-left>[not Keep Alive] "close socket"
endif
endif
endif
endif
endif



@enduml

PlantUML version 1.2017.15(Mon Jul 03 09:45:34 PDT 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.5+10-post-Ubuntu-0ubuntu1.118.04
Operating System: Linux
OS Version: 5.3.2-050302-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>