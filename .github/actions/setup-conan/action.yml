name: Setup Conan
description: "Set up Conan configuration, profile, and remote."

inputs:
  conan_remote_name:
    description: "The name of the Conan remote to use."
    required: false
    default: xrplf
  conan_remote_url:
    description: "The URL of the Conan endpoint to use."
    required: false
    default: https://conan.ripplex.io

runs:
  using: composite

  steps:
    - name: Set up Conan configuration
      shell: bash
      run: |
        echo 'Installing configuration.'
        cat conan/global.conf ${{ runner.os == 'Linux' && '>>' || '>' }} $(conan config home)/global.conf

        echo 'Conan configuration:'
        conan config show '*'

    - name: Set up Conan profile
      shell: bash
      run: |
        echo 'Installing profile.'
        conan config install conan/profiles/default -tf $(conan config home)/profiles/

        echo 'Conan profile:'
        conan profile show

    - name: Export wasmtime
      shell: bash
      run: |
        conan export --version 37.0.0 external/wasmtime

    - name: Set up Conan remote
      shell: bash
      run: |
        echo "Adding Conan remote '${{ inputs.conan_remote_name }}' at ${{ inputs.conan_remote_url }}."
        conan remote add --index 0 --force ${{ inputs.conan_remote_name }} ${{ inputs.conan_remote_url }}

        echo 'Listing Conan remotes.'
        conan remote list
